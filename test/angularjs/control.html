<!doctype html>
<html ng-app="timer">
<head>
<script src="../js/angular-1.2.2/angular.js" type="text/javascript"></script>
</head>
<body>
<div ng-controller="TimerController">
<h1 ng-click="gnClickClock();"> {{ clock.now }}!</h1>
</div>
<script type="text/javascript">
    var app = angular.module("timer", []);
    app.factory("hello", function () {
        var _name = "";
        return function (name) {
            if (_name) alert("hello " +_name+" cache");
            else _name = name;
            alert("hello " + name + "");
        };
    });
    app.service("hi", function () {
        this.sayName = function (name) {
            alert("hi " + name);
        }
    });
    app.provider("friend", function () {
        var name = "";
        this.setFriendName= function (fname) { name = fname; }
        this.$get = function () {
            return {
                hello: function () { alert("hi,my friend " + name + ",i'm can been config"); },
                init: function () { alert("init-ing");}
            };
        }
    });
    app.constant("author", "wxf");
    app.config(function (friendProvider) {
        friendProvider.setFriendName(" lixiaolong");
    });
    app.run(function (friend) {
        friend.init();//两个应用，两次调用 
    });
    app.controller("TimerController", function ($scope, $timeout, hello) {//hello  $injector注入
        $scope.clock = { now: new Date() };
        $scope.gnClickClock = function () {
            hello($scope.clock.now.getFullYear());
        };
        (function () {
            $scope.clock.now = new Date();
            caller=arguments.callee;
            $timeout(function () {
                caller.call();
            }, 1000);
        })();
    });
    var injector = angular.injector(['ng', 'timer']);//新的应用创建
    alert("author is "+injector.get("author"));
    var argus = injector.annotate(function (hello) { });//[$q, greeter]
    var hellofun = injector.get("hello");
    hellofun("get");//调试总出问题
    function injectorCat(hello, catname) {
        hello("cat " + catname);
    }
    injector.invoke(injectorCat, null, { catname: "kitty" });
    function injectorCatObj(hello, catname) {
        this.catname = catname;
        this.sayName = function () {
            hello("cat " + this.catname);
        }
    }
    var cat = injector.instantiate(injectorCatObj, { catname: "kitty" });
    cat.sayName();
    injector.get("hi").sayName("jack");
    injector.get("friend").hello();
</script>
</body>
</html>